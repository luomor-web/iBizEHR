<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper	namespace="cn.ibizlab.ehr.core.pcm.mapper.PCMGBHMCMapper">

    <!--该方法用于重写mybatis中selectById方法，以实现查询逻辑属性-->
	<select id="selectById"  resultMap="PCMGBHMCResultMap" databaseId="oracle">
        <![CDATA[select * from v_pcmgbhmc t1     where  pimpersonid=#{id}]]>
    </select>

    <!--通过mybatis将查询结果注入到entity中,通过配置autoMapping="true"由mybatis自动处理映射关系 -->
    <resultMap id="PCMGBHMCResultMap" type="cn.ibizlab.ehr.core.pcm.domain.PCMGBHMC" autoMapping="true">
        <id property="pimpersonid" column="pimpersonid" /><!--主键字段映射-->
		<result property="rznldqColor" column="rznldq_color" />
		<result property="lgnx2Color" column="lgnx2_color" />
            
		
    </resultMap>


    <!--数据集合[GBHMCNewTree]-->
	 <select id="searchGBHMCNewTree"  parameterType="cn.ibizlab.ehr.core.pcm.filter.PCMGBHMCSearchContext"  resultMap="PCMGBHMCResultMap">
         select t1.* from (
                <include refid="GBHMCNewTree" />
         )t1
         <where><if test="ew!=null and ew.sqlSegment!=null and !ew.emptyOfWhere">${ew.sqlSegment}</if></where>
         <if test="ew!=null and ew.sqlSegment!=null and ew.emptyOfWhere">${ew.sqlSegment}</if>
     </select>

    <!--数据集合[GBHMCTree]-->
	 <select id="searchGBHMCTree"  parameterType="cn.ibizlab.ehr.core.pcm.filter.PCMGBHMCSearchContext"  resultMap="PCMGBHMCResultMap">
         select t1.* from (
                <include refid="GBHMCTree" />
         )t1
         <where><if test="ew!=null and ew.sqlSegment!=null and !ew.emptyOfWhere">${ew.sqlSegment}</if></where>
         <if test="ew!=null and ew.sqlSegment!=null and ew.emptyOfWhere">${ew.sqlSegment}</if>
     </select>

    <!--数据集合[Default]-->
	 <select id="searchDefault"  parameterType="cn.ibizlab.ehr.core.pcm.filter.PCMGBHMCSearchContext"  resultMap="PCMGBHMCResultMap">
         select t1.* from (
                <include refid="Default" />
         )t1
         <where><if test="ew!=null and ew.sqlSegment!=null and !ew.emptyOfWhere">${ew.sqlSegment}</if></where>
         <if test="ew!=null and ew.sqlSegment!=null and ew.emptyOfWhere">${ew.sqlSegment}</if>
     </select>

    <!--数据集合[ZJPD]-->
	 <select id="searchZJPD"  parameterType="cn.ibizlab.ehr.core.pcm.filter.PCMGBHMCSearchContext"  resultMap="PCMGBHMCResultMap">
         select t1.* from (
                <include refid="ZJPD" />
         )t1
         <where><if test="ew!=null and ew.sqlSegment!=null and !ew.emptyOfWhere">${ew.sqlSegment}</if></where>
         <if test="ew!=null and ew.sqlSegment!=null and ew.emptyOfWhere">${ew.sqlSegment}</if>
     </select>

    <!--数据查询[Default]-->
    <sql id="Default" databaseId="oracle">
       <![CDATA[	SELECT null AS CFYXJSRQ, t1.CFYXJSRQ AS CFYXJSRQ2, t1.CJGZSJ, t1.CSRQ, null AS CZ, t1.DACJGZSJ, t1.DACSRQ, t1.DARDSJ, t1.DAXL, t1.DYXLBYSJ AS DYXLBYSJ2, t1.DYXLBYYX AS DYXLBYYX2, t1.DYXLSSZY AS DYXLSSZY2, t1.DZJBJSJ, t1.FIRSTEDUCATION, t1.GW, t1.HIGHEDUCATION, t1.HQXLBYYX AS HQXLBYYX2, t1.HQXLSXZY AS HQXLSXZY2, t1.ISLEADERTEAM, t1.JG, t1.JLCZZ, t1.JLGLBH, t1.JLSPZT, t1.JLSS, null AS JZRZ, t1.JZRZ AS JZRZ2, t1.KHCJ, 0 AS KHCJTX, t1.KHCJTX AS KHCJTX2, t1.LGKSSJ AS LGKSSJ2, t1.LGNX AS LGNX2, t1.LGNX_COLOR AS LGNX2_COLOR, t1.MZ, case when t1.DACSRQ is not null then trunc(months_between(sysdate ,t1.DACSRQ)/12)  when t1.CSRQ is not null then  trunc(months_between(sysdate ,t1.CSRQ)/12)  else null end AS NL, t21.ORDERVALUE, t1.ORMORGID AS ORGID, t1.ORGTYPE, t1.ORMORGID, t1.ORMORGNAME, t1.ORMORGSECTORID, t21.SHORTNAME AS ORMORGSECTORNAME, t1.PIMPERSONID, t1.PIMPERSONNAME, t1.POSTEXPIRATION AS POSTEXPIRATION2, t1.RANK, t1.RANKRQ, t1.RDSJ, t1.RTSJ, t1.RZDQ, t1.RZNLDQ, t1.RZNLDQ_COLOR, (case WHEN t1.RZSJ is null then null else trunc(months_between(sysdate ,t1.RZSJ)/12) END) AS RZNX, t1.RZNX AS RZNX2, t1.RZSJ, t1.SGJSRQ AS SGJSRQ2, t1.SGKSRQ AS SGKSRQ2, null AS SYCZJRQ, t1.SYCZJRQ AS SYCZJRQ2, t1.XB, t1.YGBH, t1.YGZT, case when  t1.YGZT in ('40','50','60','130','51') then '20' else '10' end AS ZGCODE, t1.ZJHM, t1.ZJNX AS ZJNX2, t1.ZT AS ZT2, t1.ZW, t1.ZWNX AS ZWNX2, t1.ZWRQ, ( select wm_concat(c2.PIMTITLECATALOGUENAME) from T_PIMTITLE c1 LEFT JOIN T_PIMTITLECATALOGUE c2 on c1.PIMTITLECATALOGUEID = c2.PIMTITLECATALOGUEID   where c1.PIMPERSONID= t1.PIMPERSONID ) AS ZYJSZW, t1.ZYZG AS ZYZG2, t31.ZZDZS, t1.ZZMM FROM T_PIMPERSON t1  LEFT JOIN T_PIMPERSON t11 ON t1.PIMPERSONID = t11.PIMPERSONID  LEFT JOIN T_SRFORGSECTOR t21 ON t11.ORMORGSECTORID = t21.ORGSECTORID  LEFT JOIN T_SRFORG t31 ON t11.ORMORGID = t31.ORGID  
				 WHERE 	( t1.JLSS = '10'  AND  case when  t1.YGZT in ('40','50','60','130','51') then '20' else '10' end = '10'  AND  t1.RANK IS NOT NULL )
			]]>
    </sql>

    <!--数据查询[GBHMCNewTree]-->
    <sql id="GBHMCNewTree" databaseId="mysql">
       <![CDATA[	SELECT null AS `CFYXJSRQ`, t1.`CJGZSJ`, t1.`CSRQ`, null AS `CZ`, t1.`DACSRQ`, (select c.JSSJ from V_PIMEDUCATION c WHERE c.ENABLE=1 AND (c.JLSS='10' OR c.JLSS is null) AND c.SFDYXL=1 AND c.PIMPERSONID=t1.`PIMPERSONID`) AS `DYXLBYSJ`, (select c.BYYX from V_PIMEDUCATION c WHERE c.ENABLE=1 AND (c.JLSS='10' OR c.JLSS is null) AND c.SFDYXL=1 AND c.PIMPERSONID=t1.`PIMPERSONID`) AS `DYXLBYYX`, (select c.SXZY from V_PIMEDUCATION c WHERE c.ENABLE=1 AND (c.JLSS='10' OR c.JLSS is null) AND c.SFDYXL=1 AND c.PIMPERSONID=t1.`PIMPERSONID`) AS `DYXLSSZY`, t1.`DZJBJSJ`, t1.`FIRSTEDUCATION`, t1.`HIGHEDUCATION`, (select c.BYYX from V_PIMEDUCATION c WHERE c.ENABLE=1 AND (c.JLSS='10' OR c.JLSS is null) AND c.SFZGXL=1 AND c.PIMPERSONID=t1.`PIMPERSONID`) AS `HQXLBYYX`, (select c.SXZY from V_PIMEDUCATION c WHERE c.ENABLE=1 AND (c.JLSS='10' OR c.JLSS is null) AND c.SFZGXL=1 AND c.PIMPERSONID=t1.`PIMPERSONID`) AS `HQXLSXZY`, t1.`ISLEADERTEAM`, t1.`JG`, t1.`JLCZZ`, t1.`JLGLBH`, t1.`JLSPZT`, t1.`JLSS`, null AS `JZRZ`, 0 AS `KHCJTX`, (select c.RZKSSJ from V_PIMDISTIRBUTION c where c.FPLX='ZFP' and c.FPZT='YXFP' AND c.\"ENABLE\"='1' and c.PIMPERSONID = t1.`PIMPERSONID` ) AS `LGKSSJ`, (select c.LGNX from V_PIMDISTIRBUTION c where c.FPLX='ZFP' and c.FPZT='YXFP' AND c.\"ENABLE\"='1' and c.PIMPERSONID = t1.`PIMPERSONID` ) AS `LGNX`, t1.`MZ`, case when t1.`DACSRQ` is not null then trunc(months_between(sysdate ,t1.`DACSRQ`)/12)  when t1.`CSRQ` is not null then  trunc(months_between(sysdate ,t1.`CSRQ`)/12)  else null end AS `NL`, t1.`ORMORGID`, t1.`ORMORGNAME`, t21.`ORGSECTORNAME` AS `ORMORGSECTORNAME`, (select c.ORMPOSTNAME from V_PIMDISTIRBUTION c where c.FPLX='ZFP' and c.FPZT='YXFP' AND c.\"ENABLE\"='1' and c.PIMPERSONID = t1.`PIMPERSONID` ) AS `ORMPOSTNAME`, t1.`PIMPERSONID`, t1.`PIMPERSONNAME`, (select c.POSTEXPIRATION from V_PIMDISTIRBUTION c where c.FPLX='ZFP' and c.FPZT='YXFP' AND c.\"ENABLE\"='1' and c.PIMPERSONID = t1.`PIMPERSONID` ) AS `POSTEXPIRATION`, t1.`RANK`, t1.`RANKRQ`, t1.`RDSJ`, t1.`RTSJ`, (case WHEN t1.`RZSJ` is null then null else trunc(months_between(sysdate ,t1.`RZSJ`)/12) END) AS `RZNX`, t1.`RZSJ`, (select c.JSSJ from T_PCMSGQMGR c WHERE c.PIMPERSONID=t1.`PIMPERSONID`  AND c.KSSJ<SYSDATE AND c.JSSJ> SYSDATE and (c.sgzt is null or c.sgzt='BTG')  AND ROWNUM<=1) AS `SGJSRQ`, (select c.KSSJ from T_PCMSGQMGR c WHERE c.PIMPERSONID=t1.`PIMPERSONID`  AND c.KSSJ<SYSDATE AND c.JSSJ> SYSDATE  and (c.sgzt is null or c.sgzt='BTG') AND ROWNUM<=1) AS `SGKSRQ`, null AS `SYCZJRQ`, t1.`XB`, t1.`YGBH`, t1.`ZJHM`, case when t1.`RANKRQ` is null then null else trunc(months_between(sysdate,nvl(t1.`RANKRQ`,sysdate))/12) end AS `ZJNX`, case when EXISTS(select 1 from  T_PCMSGQMGR c where c.pimpersonid = t1.`PIMPERSONID`  AND c.KSSJ<SYSDATE AND c.JSSJ> SYSDATE and （  c.sgzt is null or c.sgzt='SGZ'）) then 1 else 0 end AS `ZT`, t1.`ZW`, case when t1.`ZWRQ` is null then null else trunc(months_between(sysdate,nvl(t1.`ZWRQ`,sysdate))/12) end AS `ZWNX`, t1.`ZWRQ`, ( select wm_concat(c2.PIMTITLECATALOGUENAME) from T_PIMTITLE c1 LEFT JOIN T_PIMTITLECATALOGUE c2 on c1.PIMTITLECATALOGUEID = c2.PIMTITLECATALOGUEID   where c1.PIMPERSONID= t1.`PIMPERSONID` ) AS `ZYJSZW`, (select wm_concat(ZSMC) from V_PIMVOCATIONAL where PIMPERSONID = t1.`PIMPERSONID` and (JLSS = '10' OR JLSS IS NULL)   and enable=1) AS `ZYZG`, t1.`ZZMM` FROM `T_PIMPERSON` t1  LEFT JOIN T_PIMPERSON t11 ON t1.PIMPERSONID = t11.PIMPERSONID  LEFT JOIN T_SRFORGSECTOR t21 ON t11.ORMORGSECTORID = t21.ORGSECTORID  
				 WHERE 	( t1.`JLSS` = '10'  AND  t1.rank in (select ormrankid from t_ormrank r where r.xh<(select xh from t_ormrank r1 where r1.ormrankname='D1'))  AND  ( t1.`ORMORGID` =  #{srf.webcontext.nodeid}  OR  EXISTS (select orgid from T_SRFORG where ORGCODE='BG' and orgid=  #{srf.webcontext.nodeid})  OR  t1.ORMORGID IN (select orgid from T_SRFORG where  COMPANYFLAG= #{srf.webcontext.nodeid})  OR  t1.ORMORGID IN (select orgid from T_SRFORG where  porgid= #{srf.webcontext.nodeid}) ) )
			]]>
    </sql>

    <!--数据查询[GBHMCNewTree]-->
    <sql id="GBHMCNewTree" databaseId="oracle">
       <![CDATA[	SELECT null AS CFYXJSRQ, t1.CFYXJSRQ AS CFYXJSRQ2, t1.CJGZSJ, t1.CSRQ, null AS CZ, t1.DACJGZSJ, t1.DACSRQ, t1.DARDSJ, t1.DAXL, t1.DYXLBYSJ AS DYXLBYSJ2, t1.DYXLBYYX AS DYXLBYYX2, t1.DYXLSSZY AS DYXLSSZY2, t1.DZJBJSJ, t1.FIRSTEDUCATION, t1.GW, t1.HIGHEDUCATION, t1.HQXLBYYX AS HQXLBYYX2, t1.HQXLSXZY AS HQXLSXZY2, t1.ISLEADERTEAM, t1.JG, t1.JLCZZ, t1.JLGLBH, t1.JLSPZT, t1.JLSS, null AS JZRZ, t1.JZRZ AS JZRZ2, t1.KHCJ, 0 AS KHCJTX, t1.KHCJTX AS KHCJTX2, t1.LGKSSJ AS LGKSSJ2, t1.LGNX AS LGNX2, t1.LGNX_COLOR AS LGNX2_COLOR, t1.MZ, case when t1.DACSRQ is not null then trunc(months_between(sysdate ,t1.DACSRQ)/12)  when t1.CSRQ is not null then  trunc(months_between(sysdate ,t1.CSRQ)/12)  else null end AS NL, t21.ORDERVALUE, t1.ORMORGID AS ORGID, t1.ORGTYPE, t1.ORMORGID, t1.ORMORGNAME, t1.ORMORGSECTORID, t21.SHORTNAME AS ORMORGSECTORNAME, t1.PIMPERSONID, t1.PIMPERSONNAME, t1.POSTEXPIRATION AS POSTEXPIRATION2, t1.RANK, t1.RANKRQ, t1.RDSJ, t1.RTSJ, t1.RZDQ, t1.RZNLDQ, t1.RZNLDQ_COLOR, (case WHEN t1.RZSJ is null then null else trunc(months_between(sysdate ,t1.RZSJ)/12) END) AS RZNX, t1.RZNX AS RZNX2, t1.RZSJ, t1.SGJSRQ AS SGJSRQ2, t1.SGKSRQ AS SGKSRQ2, null AS SYCZJRQ, t1.SYCZJRQ AS SYCZJRQ2, t1.XB, t1.YGBH, t1.YGZT, case when  t1.YGZT in ('40','50','60','130','51') then '20' else '10' end AS ZGCODE, t1.ZJHM, t1.ZJNX AS ZJNX2, t1.ZT AS ZT2, t1.ZW, t1.ZWNX AS ZWNX2, t1.ZWRQ, ( select wm_concat(c2.PIMTITLECATALOGUENAME) from T_PIMTITLE c1 LEFT JOIN T_PIMTITLECATALOGUE c2 on c1.PIMTITLECATALOGUEID = c2.PIMTITLECATALOGUEID   where c1.PIMPERSONID= t1.PIMPERSONID ) AS ZYJSZW, t1.ZYZG AS ZYZG2, t31.ZZDZS, t1.ZZMM FROM T_PIMPERSON t1  LEFT JOIN T_PIMPERSON t11 ON t1.PIMPERSONID = t11.PIMPERSONID  LEFT JOIN T_SRFORGSECTOR t21 ON t11.ORMORGSECTORID = t21.ORGSECTORID  LEFT JOIN T_SRFORG t31 ON t11.ORMORGID = t31.ORGID  
				 WHERE 	( t1.JLSS = '10'  AND  case when  t1.YGZT in ('40','50','60','130','51') then '20' else '10' end = '10'  AND  t1.RANK IS NOT NULL  AND  ( instr(t31.levelcode, (select a.levelcode from t_srforg a where a.orgid = #{srf.webcontext.nodeid')}))=1  OR  ( ((select b.orgcode from t_srforg b where b.orgid = #{srf.webcontext.nodeid')})  in ('10101'))  and  t1.ormorgid in ( select orgid from t_srforg a where substr(a.orgcode,1,3) in ('181','182','183')) ) ) )
			]]>
    </sql>

    <!--数据查询[GBHMCTree]-->
    <sql id="GBHMCTree" databaseId="oracle">
       <![CDATA[	SELECT null AS CFYXJSRQ, t1.CFYXJSRQ AS CFYXJSRQ2, t1.CJGZSJ, t1.CSRQ, null AS CZ, t1.DACJGZSJ, t1.DACSRQ, t1.DARDSJ, t1.DAXL, t1.DYXLBYSJ AS DYXLBYSJ2, t1.DYXLBYYX AS DYXLBYYX2, t1.DYXLSSZY AS DYXLSSZY2, t1.DZJBJSJ, t1.FIRSTEDUCATION, t1.GW, t1.HIGHEDUCATION, t1.HQXLBYYX AS HQXLBYYX2, t1.HQXLSXZY AS HQXLSXZY2, t1.ISLEADERTEAM, t1.JG, t1.JLCZZ, t1.JLGLBH, t1.JLSPZT, t1.JLSS, null AS JZRZ, t1.JZRZ AS JZRZ2, t1.KHCJ, 0 AS KHCJTX, t1.KHCJTX AS KHCJTX2, t1.LGKSSJ AS LGKSSJ2, t1.LGNX AS LGNX2, t1.LGNX_COLOR AS LGNX2_COLOR, t1.MZ, case when t1.DACSRQ is not null then trunc(months_between(sysdate ,t1.DACSRQ)/12)  when t1.CSRQ is not null then  trunc(months_between(sysdate ,t1.CSRQ)/12)  else null end AS NL, t21.ORDERVALUE, t1.ORMORGID AS ORGID, t1.ORGTYPE, t1.ORMORGID, t1.ORMORGNAME, t1.ORMORGSECTORID, t21.SHORTNAME AS ORMORGSECTORNAME, t1.PIMPERSONID, t1.PIMPERSONNAME, t1.POSTEXPIRATION AS POSTEXPIRATION2, t1.RANK, t1.RANKRQ, t1.RDSJ, t1.RTSJ, t1.RZDQ, t1.RZNLDQ, t1.RZNLDQ_COLOR, (case WHEN t1.RZSJ is null then null else trunc(months_between(sysdate ,t1.RZSJ)/12) END) AS RZNX, t1.RZNX AS RZNX2, t1.RZSJ, t1.SGJSRQ AS SGJSRQ2, t1.SGKSRQ AS SGKSRQ2, null AS SYCZJRQ, t1.SYCZJRQ AS SYCZJRQ2, t1.XB, t1.YGBH, t1.YGZT, case when  t1.YGZT in ('40','50','60','130','51') then '20' else '10' end AS ZGCODE, t1.ZJHM, t1.ZJNX AS ZJNX2, t1.ZT AS ZT2, t1.ZW, t1.ZWNX AS ZWNX2, t1.ZWRQ, ( select wm_concat(c2.PIMTITLECATALOGUENAME) from T_PIMTITLE c1 LEFT JOIN T_PIMTITLECATALOGUE c2 on c1.PIMTITLECATALOGUEID = c2.PIMTITLECATALOGUEID   where c1.PIMPERSONID= t1.PIMPERSONID ) AS ZYJSZW, t1.ZYZG AS ZYZG2, t31.ZZDZS, t1.ZZMM FROM T_PIMPERSON t1  LEFT JOIN T_PIMPERSON t11 ON t1.PIMPERSONID = t11.PIMPERSONID  LEFT JOIN T_SRFORGSECTOR t21 ON t11.ORMORGSECTORID = t21.ORGSECTORID  LEFT JOIN T_SRFORG t31 ON t11.ORMORGID = t31.ORGID  
				 WHERE 	( t1.JLSS = '10'  AND  case when  t1.YGZT in ('40','50','60','130','51') then '20' else '10' end = '10'  AND  t1.RANK IS NOT NULL  AND  ( instr(t31.levelcode, (select a.levelcode from t_srforg a where a.orgid = #{srf.webcontext.nodeid')}))=1  OR  ( ((select b.orgcode from t_srforg b where b.orgid = #{srf.webcontext.nodeid')})  in ('10101'))  and  t1.ormorgid in ( select orgid from  t_srforg a where substr(a.orgcode,1,3) in ('181','182','183')) ) ) )
			]]>
    </sql>

    <!--数据查询[ZJPD]-->
    <sql id="ZJPD" databaseId="mysql">
       <![CDATA[	SELECT null AS `CFYXJSRQ`, t1.`CJGZSJ`, t1.`CSRQ`, t1.`DACSRQ`, (select c.JSSJ from V_PIMEDUCATION c WHERE c.ENABLE=1 AND (c.JLSS='10' OR c.JLSS is null) AND c.SFDYXL=1 AND c.PIMPERSONID=t1.`PIMPERSONID`) AS `DYXLBYSJ`, (select c.BYYX from V_PIMEDUCATION c WHERE c.ENABLE=1 AND (c.JLSS='10' OR c.JLSS is null) AND c.SFDYXL=1 AND c.PIMPERSONID=t1.`PIMPERSONID`) AS `DYXLBYYX`, (select c.SXZY from V_PIMEDUCATION c WHERE c.ENABLE=1 AND (c.JLSS='10' OR c.JLSS is null) AND c.SFDYXL=1 AND c.PIMPERSONID=t1.`PIMPERSONID`) AS `DYXLSSZY`, t1.`DZJBJSJ`, t1.`FIRSTEDUCATION`, t1.`HIGHEDUCATION`, (select c.BYYX from V_PIMEDUCATION c WHERE c.ENABLE=1 AND (c.JLSS='10' OR c.JLSS is null) AND c.SFZGXL=1 AND c.PIMPERSONID=t1.`PIMPERSONID`) AS `HQXLBYYX`, (select c.SXZY from V_PIMEDUCATION c WHERE c.ENABLE=1 AND (c.JLSS='10' OR c.JLSS is null) AND c.SFZGXL=1 AND c.PIMPERSONID=t1.`PIMPERSONID`) AS `HQXLSXZY`, t1.`ISLEADERTEAM`, t1.`JG`, t1.`JLCZZ`, t1.`JLGLBH`, t1.`JLSPZT`, t1.`JLSS`, null AS `JZRZ`, 0 AS `KHCJTX`, (select c.RZKSSJ from V_PIMDISTIRBUTION c where c.FPLX='ZFP' and c.FPZT='YXFP' AND c.\"ENABLE\"='1' and c.PIMPERSONID = t1.`PIMPERSONID` ) AS `LGKSSJ`, (select c.LGNX from V_PIMDISTIRBUTION c where c.FPLX='ZFP' and c.FPZT='YXFP' AND c.\"ENABLE\"='1' and c.PIMPERSONID = t1.`PIMPERSONID` ) AS `LGNX`, t1.`MZ`, case when t1.`DACSRQ` is not null then trunc(months_between(sysdate ,t1.`DACSRQ`)/12)  when t1.`CSRQ` is not null then  trunc(months_between(sysdate ,t1.`CSRQ`)/12)  else null end AS `NL`, t1.`ORMORGID`, t1.`ORMORGNAME`, t21.`ORGSECTORNAME` AS `ORMORGSECTORNAME`, (select c.ORMPOSTNAME from V_PIMDISTIRBUTION c where c.FPLX='ZFP' and c.FPZT='YXFP' AND c.\"ENABLE\"='1' and c.PIMPERSONID = t1.`PIMPERSONID` ) AS `ORMPOSTNAME`, t1.`PIMPERSONID`, t1.`PIMPERSONNAME`, (select c.POSTEXPIRATION from V_PIMDISTIRBUTION c where c.FPLX='ZFP' and c.FPZT='YXFP' AND c.\"ENABLE\"='1' and c.PIMPERSONID = t1.`PIMPERSONID` ) AS `POSTEXPIRATION`, t1.`RANK`, t1.`RANKRQ`, t1.`RDSJ`, t1.`RTSJ`, (case WHEN t1.`RZSJ` is null then null else trunc(months_between(sysdate ,t1.`RZSJ`)/12) END) AS `RZNX`, t1.`RZSJ`, (select c.JSSJ from T_PCMSGQMGR c WHERE c.PIMPERSONID=t1.`PIMPERSONID`  AND c.KSSJ<SYSDATE AND c.JSSJ> SYSDATE AND ROWNUM<=1) AS `SGJSRQ`, (select c.KSSJ from T_PCMSGQMGR c WHERE c.PIMPERSONID=t1.`PIMPERSONID`  AND c.KSSJ<SYSDATE AND c.JSSJ> SYSDATE AND ROWNUM<=1) AS `SGKSRQ`, null AS `SYCZJRQ`, t1.`XB`, t1.`YGBH`, t1.`ZJHM`, case when t1.`RANKRQ` is null then null else trunc(months_between(sysdate,nvl(t1.`RANKRQ`,sysdate))/12) end AS `ZJNX`, case when EXISTS(select 1 from  T_PCMSGQMGR c where c.pimpersonid = t1.`PIMPERSONID`  AND c.KSSJ<SYSDATE AND c.JSSJ> SYSDATE) then 1 else 0 end AS `ZT`, t1.`ZW`, case when t1.`ZWRQ` is null then null else trunc(months_between(sysdate,nvl(t1.`ZWRQ`,sysdate))/12) end AS `ZWNX`, t1.`ZWRQ`, ( select wm_concat(c2.PIMTITLECATALOGUENAME) from T_PIMTITLE c1 LEFT JOIN T_PIMTITLECATALOGUE c2 on c1.PIMTITLECATALOGUEID = c2.PIMTITLECATALOGUEID   where c1.PIMPERSONID= t1.`PIMPERSONID` ) AS `ZYJSZW`, (select wm_concat(ZSMC) from V_PIMVOCATIONAL where PIMPERSONID = t1.`PIMPERSONID` and (JLSS = '10' OR JLSS IS NULL)   and enable=1) AS `ZYZG`, t1.`ZZMM` FROM `T_PIMPERSON` t1  LEFT JOIN T_PIMPERSON t11 ON t1.PIMPERSONID = t11.PIMPERSONID  LEFT JOIN T_SRFORGSECTOR t21 ON t11.ORMORGSECTORID = t21.ORGSECTORID  
				 WHERE 	( rank )
			]]>
    </sql>

    <!--数据查询[ZJPD]-->
    <sql id="ZJPD" databaseId="oracle">
       <![CDATA[	SELECT null AS CFYXJSRQ, t1.CFYXJSRQ AS CFYXJSRQ2, t1.CJGZSJ, t1.CSRQ, null AS CZ, t1.DACJGZSJ, t1.DACSRQ, t1.DARDSJ, t1.DAXL, t1.DYXLBYSJ AS DYXLBYSJ2, t1.DYXLBYYX AS DYXLBYYX2, t1.DYXLSSZY AS DYXLSSZY2, t1.DZJBJSJ, t1.FIRSTEDUCATION, t1.GW, t1.HIGHEDUCATION, t1.HQXLBYYX AS HQXLBYYX2, t1.HQXLSXZY AS HQXLSXZY2, t1.ISLEADERTEAM, t1.JG, t1.JLCZZ, t1.JLGLBH, t1.JLSPZT, t1.JLSS, null AS JZRZ, t1.JZRZ AS JZRZ2, t1.KHCJ, 0 AS KHCJTX, t1.KHCJTX AS KHCJTX2, t1.LGKSSJ AS LGKSSJ2, t1.LGNX AS LGNX2, t1.LGNX_COLOR AS LGNX2_COLOR, t1.MZ, case when t1.DACSRQ is not null then trunc(months_between(sysdate ,t1.DACSRQ)/12)  when t1.CSRQ is not null then  trunc(months_between(sysdate ,t1.CSRQ)/12)  else null end AS NL, t21.ORDERVALUE, t1.ORMORGID AS ORGID, t1.ORGTYPE, t1.ORMORGID, t1.ORMORGNAME, t1.ORMORGSECTORID, t21.SHORTNAME AS ORMORGSECTORNAME, t1.PIMPERSONID, t1.PIMPERSONNAME, t1.POSTEXPIRATION AS POSTEXPIRATION2, t1.RANK, t1.RANKRQ, t1.RDSJ, t1.RTSJ, t1.RZDQ, t1.RZNLDQ, t1.RZNLDQ_COLOR, (case WHEN t1.RZSJ is null then null else trunc(months_between(sysdate ,t1.RZSJ)/12) END) AS RZNX, t1.RZNX AS RZNX2, t1.RZSJ, t1.SGJSRQ AS SGJSRQ2, t1.SGKSRQ AS SGKSRQ2, null AS SYCZJRQ, t1.SYCZJRQ AS SYCZJRQ2, t1.XB, t1.YGBH, t1.YGZT, case when  t1.YGZT in ('40','50','60','130','51') then '20' else '10' end AS ZGCODE, t1.ZJHM, t1.ZJNX AS ZJNX2, t1.ZT AS ZT2, t1.ZW, t1.ZWNX AS ZWNX2, t1.ZWRQ, ( select wm_concat(c2.PIMTITLECATALOGUENAME) from T_PIMTITLE c1 LEFT JOIN T_PIMTITLECATALOGUE c2 on c1.PIMTITLECATALOGUEID = c2.PIMTITLECATALOGUEID   where c1.PIMPERSONID= t1.PIMPERSONID ) AS ZYJSZW, t1.ZYZG AS ZYZG2, t31.ZZDZS, t1.ZZMM FROM T_PIMPERSON t1  LEFT JOIN T_PIMPERSON t11 ON t1.PIMPERSONID = t11.PIMPERSONID  LEFT JOIN T_SRFORGSECTOR t21 ON t11.ORMORGSECTORID = t21.ORGSECTORID  LEFT JOIN T_SRFORG t31 ON t11.ORMORGID = t31.ORGID  
				 WHERE 	( t1.JLSS = '10'  AND  case when  t1.YGZT in ('40','50','60','130','51') then '20' else '10' end = '10'  AND  t1.rank in (select ormrankid from t_ormrank r where r.xh<(select xh from t_ormrank r1 where r1.ormrankname='D1')) )
			]]>
    </sql>

</mapper>

